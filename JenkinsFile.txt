pipeline
{
   agent any
   stages
  {
      environment{
         DOCKERHUB_CREDENTIALS = 'dockerhub-creds'
         DOCKER_HUB_USER = ''
         IMAGE_NAME = 'myapp' 
      } 
      stage('Clone Repository'){
          steps{
             git branch: 'practice',
                 url:  'https://github.com/ShilpaKuntla/gs-rest-service'
          }
      }
     stage('Build Project'){
         steps{
            sh "mvn clean package -DskipTests"
         }
     }  
     stage('Build Docker Image'){
         steps{
            sh "docker build -t ${DOCKER_HUB_USER}${IMAGE_NAME}:latest ."
         }
     }
     stage('Login to Docker Hub'){
         steps{
            sh "docker build -t ${ImageName} ."
         }
     }
     stage('Push Docker Image'){
         steps{
            sh "docker push -t ${DOCKER_HUB_USER}${IMAGE_NAME}:latest"
         }
     }
     post{
        always{
            sh 'docker logout ghcr.io'
        }
     } 
      
  }


}
